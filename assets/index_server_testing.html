<!DOCTYPE html>
<html>

<head>
    <!--@formatter:off -->

    <link href="./index.css" rel="stylesheet">
    <link href="https://assets.mediadelivery.net/rubik.css" rel="stylesheet">
    <link href="https://assets.mediadelivery.net/plyr/3.7.8.1-bn/plyr.css" rel="stylesheet">
    <link href="https://assets.mediadelivery.net/plyr-vr.css" rel="stylesheet">
    <link href="https://assets.mediadelivery.net/pb.css?v=1" rel="stylesheet">
    <link href="https://fonts.bunny.net/css?family=rubik" rel="stylesheet" />

    <script src="https://assets.mediadelivery.net/hls/1.5.10/hls.min.js"></script>
    <script src="https://assets.mediadelivery.net/rum.js"></script>
    <script src="https://assets.mediadelivery.net/plyr/3.7.8.1-bn/plyr.polyfilled.min.js"></script>
    <script src="https://assets.mediadelivery.net/plyr-plugin-thumbnail.js"></script>
    <script src="https://assets.mediadelivery.net/session-tracker/1.1.2/session-tracker.js"></script>
    <script src="https://assets.mediadelivery.net/jquery/jquery-3.7.1.min.js" type="text/javascript"></script>
    <script src="https://assets.mediadelivery.net/chartist.min.js" type="text/javascript"></script>
    <script src="https://assets.mediadelivery.net/plyr-vr.js" type="text/javascript"></script>
    <script src="https://assets.mediadelivery.net/pb.js?v=1"></script>
    <script src="https://assets.mediadelivery.net/playerjs/pjs-implementation.js" type="text/javascript"></script>
    <script src="https://assets.mediadelivery.net/playerjs/player-0.1.0.min.js" type="text/javascript"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="" />
    <meta property="og:url"
        content="https://iframe.mediadelivery.net/embed/84972/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382" />
    <meta property="og:image"
        content="https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/thumbnail.jpg" />
    <meta property="og:image:secure_url"
        content="https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/thumbnail.jpg" />
    <meta property="og:site_name" content="bunny.net" />
    <meta property="og:title" content="37 RS.mp4" />
    <meta property="og:description" content="" />
    <meta property="og:type" content="video.other" />

    <meta property="og:video:url"
        content="https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/play_720p.mp4" />
    <meta property="og:video:secure_url"
        content="https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/play_720p.mp4" />

    <meta property="og:video:type" content="text/html" />
    <meta property="og:video:width" content="1080">
    <meta property="og:video:height" content="1920">
    <meta property="video:duration" content="37">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="player">
    <meta property="twitter:domain" content="bunny.net">
    <meta property="twitter:url"
        content="https://iframe.mediadelivery.net/embed/84972/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382">
    <meta name="twitter:title" content="37 RS.mp4">
    <meta name="twitter:description" content="">
    <meta name="twitter:image"
        content="https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/thumbnail.jpg">
    <meta name="twitter:player"
        content="https://iframe.mediadelivery.net/embed/84972/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382">
    <meta name="twitter:player:width" content="1080">
    <meta name="twitter:player:height" content="1920">




    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "VideoObject",
        "name": "37 RS.mp4",
        "description": "",
        "thumbnailUrl": "https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/thumbnail.jpg",
        "uploadDate": "2024-06-28T10:15:29.2420000+00:00",
        "duration": "PT37S",
        "embedUrl": "https://iframe.mediadelivery.net/embed/84972/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382"
    }
    </script>
</head>

<body id="body">
    <div class="container" id="video-container">
        <svg viewBox="0 0 0 0" style="height: 0; width: 0; display: block;">
            <defs>
                <linearGradient id="gradient-a" x2="0%" y2="100%">
                    <stop offset="0%" stop-color="#abababaf"></stop>
                    <stop offset="30%" stop-color="#ababab8f"></stop>
                    <stop offset="70%" stop-color="#ababab5f"></stop>
                    <stop offset="100%" stop-color="#ababab33"></stop>
                </linearGradient>
                <linearGradient id="gradient-active" x2="0%" y2="100%">
                    <stop offset="0%" stop-color="#ff7755af"></stop>
                    <stop offset="30%" stop-color="#ff77558f"></stop>
                    <stop offset="70%" stop-color="#ff77553f"></stop>
                    <stop offset="100%" stop-color="#ff775513"></stop>
                </linearGradient>
            </defs>
        </svg>

        <div class="loader-position">
            <div class="loader" id="loader"></div>
        </div>

        <video id="main-video" preload="auto" crossorigin playsinline loop
            data-poster="https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/thumbnail.jpg">
            <source src="https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/playlist.m3u8">
        </video>

        <!-- <video id="main-video" preload="auto" crossorigin autoplay loop muted
            data-plyr-config='{ "title": "37 RS.mp4" }' playsinline
            data-poster="https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/thumbnail.jpg">
            <source src="https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/playlist.m3u8">
        </video> -->
    </div>
    <script type="text/javascript">
        var shouldAutoplay = '{{autoplay}}';

        var videoElement = document.getElementById('main-video');

        if (shouldAutoplay == 'true') {
            videoElement.setAttribute('autoplay', '');
            videoElement.play();
        }

        var thumbnail_width = 300;
        var seek_thumbnail_config = {
            enabled: true,
            pic_num: 18,
            width: thumbnail_width,
            height: thumbnail_width * 9 / 16,
            col: 6,
            row: 6,
            offsetX: 0,
            offsetY: 0,
            urls: [
                'https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/seek/_0.jpg',
            ]
        }

        function getSeekThumbnailHeight(imgWidth, imgHeight) {
            var aspectRatio = imgWidth / imgHeight;
            return Math.floor(thumbnail_width / aspectRatio);
        }

        var prevShowImage = null;
        function setSeekThumbnailHeight(player) {
            if (prevShowImage || !player || !player.thumbnails)
                return;

            prevShowImage = player.thumbnails.showImage;

            player.thumbnails.showImage = function (previewImage, qualityIndex, thumbNum, thumbFilename, newImage) {
                if (previewImage.width > 0 && previewImage.height > 0)
                    player.config.thumbnail.height = getSeekThumbnailHeight(previewImage.width, previewImage.height);
                prevShowImage.call(player.thumbnails, previewImage, qualityIndex, thumbNum, thumbFilename, newImage);
            }
        }

        var video_start_time = 0;
        function setPlayerStartingPosition(player) {
            if (video_start_time > 0) {
                player.on('loadeddata', function (event) {
                    var instance = event.detail.plyr;
                    if (video_start_time <= instance.duration) {
                        instance.off('loadeddata', event);
                        instance.currentTime = video_start_time;
                    }
                });
            }
        }

        var videoSessionTracker = new BunnyStreamSessionTracker(
            "mediadelivery.net",
            "video-1223.mediadelivery.net",
            84972,
            "29d0d68f-bc31-4c9b-bd6a-bcbc0c526382",
            "1223"
        );

        var errorEvents = {};
        function loadUrl(url, onFinished) {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == XMLHttpRequest.DONE) {   // XMLHttpRequest.DONE == 4
                    if (xmlhttp.status == 200) {
                        onFinished(xmlhttp.responseText);
                    }
                }
            };

            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }

        document.addEventListener('DOMContentLoaded', (event) => {
            const video = document.getElementById('main-video');
            const loader = document.getElementById('loader');

            video.addEventListener('loadeddata', () => {
                loader.style.display = 'none';
            });

            video.addEventListener('waiting', () => {
                loader.style.display = 'flex';
            });

            video.addEventListener('playing', () => {
                loader.style.display = 'none';
            });
        });

        document.addEventListener("DOMContentLoaded", async function () {
            var video = document.querySelector("video");
            var fragmentsLoaded = 0;
            var player = null;
            var isFairplay = false;
            var useFairplayInternalEngine = false;
            var useFairplayHlsJs = false;
            var isEntDrm = false;
            var playOriginal = false;
            var originalUrl = 'https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/original';
            var urlPlaylistUrl = 'https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/playlist.m3u8';
            var isHlsSupported = (!isFairplay || useFairplayHlsJs) && Hls.isSupported();
            var source = video.getElementsByTagName("source")[0].src;
            var isAdPaused = false;

            var prioritizeSegmentHttpResponseCode = 600;
            var prioritizeSegmentProbingInterval = 0;
            var isAirplayEnabled = true;

            function manageChromecastAvailableTrigger(cjs) {
                if (isEntDrm == false) {

                    $(".plyr__controls").append(($('<button class="plyr__controls__item plyr__control chromecast chromecast-disconnected"><svg aria-hidden="true" focusable="false"><use xlink:href="#chromecast"></use></svg></button>')));

                    $('.chromecast').click(function () {
                        if (cjs.available) {
                            if (cjs.connected) {
                                cjs.disconnect();
                            }
                            else {
                                var castUrl = '';
                                if (playOriginal) {
                                    castUrl = originalUrl;
                                }
                                else {
                                    castUrl = urlPlaylistUrl;
                                }

                                cjs.cast(castUrl, {
                                    poster: 'https://vz-352e339f-24b.b-cdn.net/29d0d68f-bc31-4c9b-bd6a-bcbc0c526382/thumbnail.jpg',
                                    title: '37 RS.mp4',
                                    subtitles: []
                                })
                            }
                        }
                    });
                }
            }

            var defaultOptions = {
                storage: {
                    enabled: true,
                    key: 'plyr--lib-84972'
                },
                fullscreen: {
                    enabled: true,
                    fallback: true,
                    iosNative: true
                },

                iconUrl: 'https://assets.mediadelivery.net/plyr/3.7.3.2/plyr.svg',
                captions: { active: false, language: '', update: true },
                controls: [
                    // "volume", "play-large", "play", "rewind", "fast-forward", "progress", "current-time", "duration", "mute", "volume", "settings", "pip", "airplay", "fullscreen", "audioTrack", "chromecast"
                ],
                settings: ['quality', 'speed', 'loop', 'audioTrack'],
                speed: { selected: 1, options: [0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 4] },
                i18n: {
                    restart: 'Restart',
                    rewind: 'Rewind {seektime}s',
                    play: 'Play',
                    pause: 'Pause',
                    fastForward: 'Forward {seektime}s',
                    seek: 'Seek',
                    seekLabel: '{currentTime} of {duration}',
                    played: 'Played',
                    buffered: 'Buffered',
                    currentTime: 'Current time',
                    duration: 'Duration',
                    volume: 'Volume',
                    mute: 'Mute',
                    unmute: 'Unmute',
                    enableCaptions: 'Enable captions',
                    disableCaptions: 'Disable captions',
                    download: 'Download',
                    enterFullscreen: 'Enter fullscreen',
                    exitFullscreen: 'Exit fullscreen',
                    frameTitle: 'Player for {title}',
                    captions: 'Captions',
                    settings: 'Settings',
                    pip: 'PIP',
                    menuBack: 'Go back to previous menu',
                    speed: 'Speed',
                    normal: 'Normal',
                    quality: 'Quality',
                    loop: 'Loop',
                    start: 'Start',
                    end: 'End',
                    all: 'All',
                    reset: 'Reset',
                    disabled: 'Disabled',
                    enabled: 'Enabled',
                    advertisement: 'Ad',
                    qualityBadge: {
                        2160: '4K',
                        1440: 'HD',
                        1080: 'HD',
                        720: 'HD',
                        576: 'SD',
                        480: 'SD',
                    },
                },
                thumbnail: seek_thumbnail_config,

            };

            function initPlayer() {
                // needed for displaying right direction of the captions
                player.elements.captions.dir = "auto";

                $('<div class="plyr__controls__item hide_mobile plyr__spacer"></div>').insertBefore(".plyr__progress__container");

                /* Heatmap Chart */

                $("video").on('webkitbeginfullscreen webkitendfullscreen', function (event) {
                    if (event.type === 'webkitbeginfullscreen') {
                        document.documentElement.style.setProperty('--webkit-text-track-display', 'block');
                    } else {
                        document.documentElement.style.setProperty('--webkit-text-track-display', 'none');
                    }
                });

                /* VAST management */
                document.addEventListener('visibilitychange', function (e) {
                    if (!document.hidden && player.ads != null && player.ads.playing) {
                        player.ads.manager.resume();
                    }
                });

                setPlayerStartingPosition(player);

                /* Session tracking */
                player.on("play", function () {
                    videoSessionTracker.OnPlay();
                });

                player.on("playing", function () {
                    videoSessionTracker.OnPlaying();

                });

                player.on("pause", function () {
                    videoSessionTracker.OnPause();
                });

                player.on("seeked", function () { });

                player.on("languagechange", function (e) { });

                setInterval(function () {
                    if (!video.paused) {
                        window.Duration.postMessage(player.duration);
                        window.CurrentDuration.postMessage(player.currentTime);
                    }
                    videoSessionTracker.OnProgress(player.currentTime);
                }, 900);

                /* Progress bar */
                var scrubbingPaused = false;
                var isMobile = true;
                $(".plyr__progress__container input").css("top", "-5px");
                $(".plyr__progress__container progress").css("top", "4px");
                $(".plyr__progress__container progress").css("opacity", "0.01");
                $(".plyr__progress").prepend($('<div class="plyr__pb"></div>'));
                var pb = new PB(".plyr__pb", ".plyr__progress__container input", {
                    keyColor: "#ff7755",
                    videoLength: 37,
                    chapters: [

                    ],
                    moments: [

                    ],
                    // onScrubbingChange: function (seekTime, offset) {
                    //     var thumbWidth = $(".plyr__preview-thumb").width();
                    //     var position = Math.max(thumbWidth / 2, offset);
                    //     position = Math.min($(".plyr__controls").width() - $(".plyr__preview-thumb").width() + (thumbWidth / 4), position);
                    //     $(".plyr__preview-thumb").css("left", (position - 5.5) + "px");
                    // }
                });

                function subscribeAdManagerEvent() {
                    if (player.ads != null) {

                        Object.keys(google.ima.AdEvent.Type).forEach(function (e) {

                            player.ads.manager.addEventListener(google.ima.AdEvent.Type[e], function (e) {
                                switch (e.type) {
                                    case 'pause':
                                        isAdPaused = true;
                                        break;
                                    case 'complete':
                                    case 'allAdsCompleted':
                                    case 'userClose':
                                    case 'start':
                                    case 'resume':
                                    case 'loaded':
                                        isAdPaused = false;
                                        break;
                                    case 'click':

                                        if (isAdPaused)
                                            player.ads.manager.resume();
                                        break;
                                }
                            });
                        });
                    }
                }

                document.addEventListener('ready', function () {
                    setSeekThumbnailHeight(player);
                });

                player.on("loadedmetadata", function () {
                    pb.SetDuration(player.duration);
                    if (player.ads != null && player.ads.manager == null) {
                        if (player.ads.loader != null) {
                            player.ads.loader.addEventListener("adsManagerLoaded", function (e) {
                                subscribeAdManagerEvent();
                            }, false);
                        }
                    }
                    else {
                        subscribeAdManagerEvent();
                    }
                });

                setInterval(function () {
                    pb.SetCurrentProgress(player.currentTime);

                    pb.SetBufferProgress(player.duration * player.buffered * 0.04);
                }, 16);
                /* Progress bar */


                function getStatusObject() {
                    return {
                        volume: player.volume,
                        muted: player.muted,
                        hideControls: player.hideControls,
                        speed: player.speed,
                        quality: player.quality,
                        currentTime: player.currentTime,
                        playing: player.playing,
                        paused: player.paused,
                        stopped: player.stopped,
                        ended: player.ended,
                        buffered: player.buffered,
                        duration: player.duration,
                        hasAudio: player.hasAudio,
                        loop: player.loop,
                        language: player.language,
                        ratio: player.ratio,
                    };
                }

                window.sendEvent = function sendEvent(name) {
                    window.parent.postMessage({
                        channel: "bunnystream",
                        video: "29d0d68f-bc31-4c9b-bd6a-bcbc0c526382",
                        event: name,
                        status: getStatusObject(),
                    }, '*');
                }

                function wireEvent(name) {
                    player.on(name, function () { sendEvent(name) });
                }

                function wireUpEvents() {
                    wireEvent("progress");
                    wireEvent("ready");
                    wireEvent("play");
                    wireEvent("pause");
                    wireEvent("timeupdate");
                    wireEvent("seeking");
                    wireEvent("seeked");
                    wireEvent("ended");
                    wireEvent("ratechange");
                    wireEvent("enterfullscreen");
                    wireEvent("exitfullscreen");
                    wireEvent("captionsenabled");
                    wireEvent("captionsdisabled");
                    wireEvent("languagechange");
                    wireEvent("ready");
                }

                window.onmessage = function (e) {
                    var message = e.data;
                    console.log(e.data);
                    if (message.command == 'activate') {
                        wireUpEvents();
                    }
                    else if (message.command == 'pause') {
                        player.pause();
                    }
                    else if (message.command == 'play') {
                        player.play();
                    }
                    else if (message.command == 'togglePlay') {
                        if (message.parameter != null)
                            player.togglePlay(message.parameter);
                        else
                            player.togglePlay();
                    }
                    else if (message.command == 'destroy') {
                        player.destroy();
                    }
                    else if (message.command == 'increaseVolume') {
                        if (message.parameter != null)
                            player.increaseVolume(message.parameter);
                        else
                            player.increaseVolume(0.1);
                    }
                    else if (message.command == 'decreaseVolume') {
                        if (message.parameter != null)
                            player.decreaseVolume(message.parameter);
                        else
                            player.decreaseVolume(0.1);
                    }
                    else if (message.command == 'toggleCaptions') {
                        if (message.parameter != null)
                            player.toggleCaptions(message.parameter);
                        else
                            player.toggleCaptions();
                    }
                    else if (message.command == 'toggleControls') {
                        if (message.parameter != null)
                            player.toggleControls(message.parameter);
                        else
                            player.toggleControls();
                    }
                    else if (message.command == 'fullscreen.enter') {
                        player.fullscreen.enter();
                    }
                    else if (message.command == 'fullscreen.exit') {
                        player.fullscreen.exit();
                    }
                    else if (message.command == 'fullscreen.toggle') {
                        player.fullscreen.toggle();
                    }
                    else if (message.command == 'forward') {
                        if (message.parameter != null)
                            player.forward(message.parameter);
                        else
                            player.forward();
                    }
                    else if (message.command == 'rewind') {
                        if (message.parameter != null)
                            player.rewind(message.parameter);
                        else
                            player.rewind();
                    }
                };

                var pjs = new BunnyPlayerJs(player);
                pjs.init();

                window.flutterControl = function (e) {
                    var message = e;
                    if (message.command == 'activate') {
                        wireUpEvents();
                    }
                    else if (message.command == 'pause') {
                        player.pause();
                    }
                    else if (message.command == 'play') {
                        player.play();
                    }
                    else if (message.command == 'togglePlay') {
                        if (message.parameter != null)
                            player.togglePlay(message.parameter);
                        else
                            player.togglePlay();
                    }
                    else if (message.command == 'destroy') {
                        player.destroy();
                    }
                    else if (message.command == 'increaseVolume') {
                        if (message.parameter != null)
                            player.increaseVolume(message.parameter);
                        else
                            player.increaseVolume(0.8);
                    }
                    else if (message.command == 'decreaseVolume') {
                        if (message.parameter != null)
                            player.decreaseVolume(message.parameter);
                        else
                            player.decreaseVolume(0.1);
                    } else if (message.command == 'changeToMediumQuality') {
                        // Auto
                        if (hls.levels.length == 1) {
                            window.hls.currentLevel = 0;
                        }
                        else if (hls.levels.length == 2) {
                            window.hls.currentLevel = 1;
                        }
                        else {
                            window.hls.currentLevel = 2;
                        }
                        // player.decreaseVolume(0.1);
                    }
                    else if (message.command == 'toggleCaptions') {
                        if (message.parameter != null)
                            player.toggleCaptions(message.parameter);
                        else
                            player.toggleCaptions();
                    }
                    else if (message.command == 'toggleControls') {
                        if (message.parameter != null)
                            player.toggleControls(message.parameter);
                        else
                            player.toggleControls();
                    }
                    else if (message.command == 'fullscreen.enter') {
                        player.fullscreen.enter();
                    }
                    else if (message.command == 'fullscreen.exit') {
                        player.fullscreen.exit();
                    }
                    else if (message.command == 'fullscreen.toggle') {
                        player.fullscreen.toggle();
                    }
                    else if (message.command == 'forward') {
                        if (message.parameter != null)
                            player.forward(message.parameter);
                        else
                            player.forward();
                    }
                    else if (message.command == 'rewind') {
                        if (message.parameter != null)
                            player.rewind(message.parameter);
                        else
                            player.rewind();
                    }
                    else if (message.command == 'seek') {
                        if (message.parameter != null)
                            player.currentTime = message.parameter;
                        else
                            player.currentTime = 10;
                    }
                    else if (message.command == 'qulitity') {
                        if (message.parameter != null)
                            updateQuality(message.parameter);
                        else
                            updateQuality(-1)
                    }
                    else if (message.command == 'speed') {
                        if (message.parameter != null)
                            player.speed = message.parameter;
                        else
                            player.speed = 1;
                    }
                };
            }

            if (isHlsSupported) {
                var premiumProbingVideos = new Map();
                var hlsConfig = {
                    debug: false,
                    abrEwmaDefaultEstimate: 5000000,
                    maxBufferLength: 80,
                    minBufferLength: 20,
                    autoStartLoad: true,
                    xhrSetup: function (xhr, url) { },
                };



                var hls = new Hls(hlsConfig);
                hls.loadSource(source);

                hls.on(
                    Hls.Events.MANIFEST_PARSED,
                    function (event, data) {
                        if (data.audioTracks && data.audioTracks.length) {
                            const languageOptions = Array.from(new Set(data.audioTracks.map(a => a.name)));
                            console.log(languageOptions);
                            defaultOptions.audioTrack = {
                                options: languageOptions,
                                selected: languageOptions[0],
                                onChange: (e) => {
                                    let index = hls.audioTracks.findLastIndex(x => x.name == e);
                                    if (index < 0)
                                        index = 0;
                                    hls.audioTrack = index;
                                },
                                showUnrecognizedLabel: false,
                            };

                            hls.audioTrack = 0;
                        }

                        if (window.hls.currentLevel == -1) {
                            if (hls.levels.length == 1) {
                                window.hls.currentLevel = 0;
                            }
                            else if (hls.levels.length == 2) {
                                window.hls.currentLevel = 1;
                            }
                            else {
                                window.hls.currentLevel = 2;
                            }
                        }

                        var availableQualities = hls.levels.map(function (l) { return l.height });
                        availableQualities.unshift(-1)

                        defaultOptions.quality = {
                            default: -1,
                            options: availableQualities,
                            forced: true,
                            onChange: function (e) { updateQuality(e); },
                        }

                        defaultOptions.i18n["qualityLabel"] = { "-1": "Auto" };

                        player = new Plyr(video, defaultOptions);
                        initPlayer();
                    },

                );

                hls.on(Hls.Events.LEVEL_SWITCHED, function (event, data) {
                    var span = document.querySelector(".plyr__controls [data-plyr='quality'][value='-1'] span")
                    if (span != null) {
                        if (hls.autoLevelEnabled) {
                            var height = hls.levels[data.level].height;
                            span.innerHTML = 'Auto (' + height + 'p)'
                        } else {
                            span.innerHTML = 'Auto'
                        }
                    }
                });

                hls.on(Hls.Events.ERROR, function (event, data) {
                    if (errorEvents[data.details] == undefined) {
                        errorEvents[data.details] = 0;
                    }



                    console.error("HLS error occured:", data);
                    errorEvents[data.details] += 1;

                    if (data.fatal) {
                        console.error("HLS fatal error occured:", data);
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                // try to recover network error
                                console.log('fatal network error encountered, try to recover');
                                hls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                console.log('fatal media error encountered, try to recover');
                                hls.recoverMediaError();
                                break;
                            default:
                                break;
                        }
                    }
                });

                setInterval(function () {
                    var bandwidth = hls.abrController.bwEstimator.getEstimate();
                    if (isNaN(bandwidth)) {
                        bandwidth = 0;
                    }
                    if (!video.paused) {

                        var errorEventsString = "";
                        var keys = Object.keys(errorEvents);
                        for (var i = 0; i < keys.length; i++) {
                            var key = keys[i];
                            var value = errorEvents[key];
                            if (errorEventsString != "") {
                                errorEventsString += ",";
                            }
                            errorEventsString += (key + "=" + value);
                        }

                        loadUrl("https://video-1223.mediadelivery.net/.metrics/add?errorEvents=" + errorEventsString + "&bandwidth=" + bandwidth + "&zoneTier=" + 'volume', function (data) { });
                        errorEvents = {};
                    }
                }, 15000);

                hls.attachMedia(video);

                if (isAirplayEnabled) {
                    var source = document.createElement('source');
                    source.src = urlPlaylistUrl;
                    video.appendChild(source);
                    video.disableRemotePlayback = false;
                }

                window.hls = hls;
            }
            else {
                // hls not supported
                defaultOptions.quality = {
                    default: 240,
                    options: [240, 320, 480, 720]
                };

                player = new Plyr(video, defaultOptions);
                initPlayer();


            }

            function getRoutes(request) {
                let routes = new Map();
                var p = new URL(request).pathname.split("/");
                for (var i = 1; i < p.length - 1; i += 2) {
                    routes.set(p[i], p[i + 1]);
                }
                return routes;
            }

            function updateQuality(newQuality) {
                if (newQuality === -1) {
                    window.hls.currentLevel = -1; //Enable AUTO quality if option.value = -1
                } else {
                    window.hls.levels.forEach(function (level, levelIndex) {
                        if (level.height === newQuality) {
                            console.log("Found quality match with " + newQuality);
                            window.hls.currentLevel = levelIndex;
                        }
                    });
                }
            };
        });

        function centerVertically() {
            var container = document.getElementById("body");
            var inner = document.getElementById("video-container");

            var inHeight = inner.offsetHeight;
            var conHeight = container.offsetHeight;

            inner.style.marginTop = ((conHeight - inHeight) / 2) + 'px';
        }
        centerVertically();
        window.addEventListener("resize", centerVertically);
    </script>
</body>

</html>